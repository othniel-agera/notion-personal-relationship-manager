{"version":3,"file":"auth.spec.js","sourceRoot":"","sources":["../../src/test/auth.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import { app, request, expect, UserModel } from \"./common.spec\";\n\ndescribe(\"/auth\", () => {\n  beforeEach(async () => {\n    await UserModel.deleteMany({});\n  });\n  describe(\"GET /users\", () => {\n    it(\"should return all users\", async () => {\n      const users = [\n        {\n          username: \"otagera\",\n          password: \"12345678\",\n          email: \"string\",\n          address: \"string\",\n          firstname: \"string\",\n          lastname: \"string\",\n        },\n        {\n          username: \"leo\",\n          password: \"12345678\",\n          email: \"string\",\n          address: \"string\",\n          firstname: \"string\",\n          lastname: \"string\",\n        },\n        {\n          username: \"lenxo\",\n          password: \"12345678\",\n          email: \"string\",\n          address: \"string\",\n          firstname: \"string\",\n          lastname: \"string\",\n        },\n      ];\n      await UserModel.insertMany(users);\n      const res = await request(app).get(\"/auth/users\");\n      expect(res.status).to.equal(200);\n      expect(res.body.data.users.length).to.equal(3);\n    });\n  });\n\n  describe(\"GET /users/:id\", () => {\n    it(\"should return a user if valid id is passed\", async () => {\n      const user = new UserModel({\n        username: \"otagera\",\n        password: 12345678,\n        email: \"string\",\n        address: \"string\",\n        firstname: \"string\",\n        lastname: \"string\",\n      });\n      await user.save();\n      const res = await request(app).get(\"/auth/users/\" + user._id);\n      expect(res.status).to.equal(200);\n      expect(res.body.data.user).to.have.property(\"username\", user.username);\n    });\n    it(\"should return 404 error when invalid object id is passed\", async () => {\n      const res = await request(app).get(\"/auth/users/1\");\n      expect(res.status).to.equal(400);\n    });\n    it(\"should return 404 when valid object id is passed but does not exist\", async () => {\n      const res = await request(app).get(\"/auth/users/123456789012\");\n      expect(res.status).to.equal(404);\n    });\n  });\n\n  describe(\"POST /signup\", () => {\n    it(\"should return new user when all request body is valid to signup\", async () => {\n      const res = await request(app).post(\"/auth/signup\").send({\n        username: \"lenzo\",\n        password: \"12345678\",\n        email: \"string\",\n        address: \"string\",\n        firstname: \"string\",\n        lastname: \"string\",\n      });\n      expect(res.status).to.equal(200);\n      expect(res.body.data.user).to.have.property(\"username\", \"lenzo\");\n    });\n  });\n\n  describe(\"POST /login\", () => {\n    it(\"should throw error because of wrong username\", async () => {\n      const res = await request(app).post(\"/auth/signup\").send({\n        username: \"lenzo\",\n        password: \"12345678\",\n        email: \"string\",\n        address: \"string\",\n        firstname: \"string\",\n        lastname: \"string\",\n      });\n      expect(res.status).to.equal(200);\n      expect(res.body.data.user).to.have.property(\"username\", \"lenzo\");\n\n      const loginWrongUsernameRes = await request(app)\n        .post(\"/auth/login\")\n        .send({\n          username: \"lenzoo\",\n          password: \"12345678\",\n        });\n      expect(loginWrongUsernameRes.status).to.equal(401);\n    });\n    it(\"should throw an error because of wrong password\", async () => {\n      const res = await request(app).post(\"/auth/signup\").send({\n        username: \"lenzo\",\n        password: \"12345678\",\n        email: \"string\",\n        address: \"string\",\n        firstname: \"string\",\n        lastname: \"string\",\n      });\n      expect(res.status).to.equal(200);\n      expect(res.body.data.user).to.have.property(\"username\", \"lenzo\");\n\n      const loginWrongPasswordRes = await request(app)\n        .post(\"/auth/login\")\n        .send({\n          username: \"lenzo\",\n          password: \"123456789\",\n        });\n      expect(loginWrongPasswordRes.status).to.equal(402);\n    });\n    it(\"should return tokens after login in\", async () => {\n      const res = await request(app).post(\"/auth/signup\").send({\n        username: \"lenzo\",\n        password: \"12345678\",\n        email: \"string\",\n        address: \"string\",\n        firstname: \"string\",\n        lastname: \"string\",\n      });\n      expect(res.status).to.equal(200);\n      expect(res.body.data.user).to.have.property(\"username\", \"lenzo\");\n\n      const loginRes = await request(app).post(\"/auth/login\").send({\n        username: \"lenzo\",\n        password: \"12345678\",\n        email: \"string\",\n        address: \"string\",\n        firstname: \"string\",\n        lastname: \"string\",\n      });\n      expect(loginRes.status).to.equal(200);\n    });\n  });\n});\n"]}